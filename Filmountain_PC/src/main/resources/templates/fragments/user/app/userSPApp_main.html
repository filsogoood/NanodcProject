<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
		
<div class="content main-content" th:fragment="MainContent">
    <style>
        /* 컬러 팔레트 */
        :root {
            --color-bg-main: #121218; /* 어두운 배경 */
            --color-bg-card: #1a1a22; /* 카드 배경 */
            --color-accent-pink: #e12788; /* 분홍색 액센트 */
            --color-accent-yellow: #ede93c; /* 노란색 액센트 */
            --color-accent-teal: #65c2c6; /* 청록색 액센트 */
            --color-text-primary: #ffffff; /* 기본 텍스트 */
            --color-text-secondary: rgba(255, 255, 255, 0.7); /* 보조 텍스트 */
            --gradient-card: linear-gradient(145deg, #1a1a22, #222230); /* 그레이디언트 카드 배경 */
        }

        /* 모바일 웹뷰 최적화 메인 콘텐츠 스타일 */
        .main-content {
            padding: 70px 0 70px 0; /* 상단바와 하단바 고려한 패딩 */
            background-color: var(--color-bg-main);
            min-height: 100vh;
            color: var(--color-text-primary);
        }

        .dashboard-wrapper {
            padding: 12px;
        }

        /* 투자 리스트 디자인 */
        .investment-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 16px;
        }

        .investment-card {
            background: var(--gradient-card);
            border-radius: 16px;
            padding: 18px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        /* FIL 코인용 카드 스타일 */
        .investment-card.coin-fil {
            border-left: 3px solid var(--color-accent-teal);
        }
        
        /* ATH 코인용 카드 스타일 */
        .investment-card.coin-ath {
            border-left: 3px solid var(--color-accent-yellow);
        }

        .investment-card:active {
            transform: scale(0.98);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .investment-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
        }

        .investment-title-section {
            display: flex;
            align-items: center;
        }

        .investment-icon {
            width: 42px;
            height: 42px;
            min-width: 42px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin-right: 16px;
            background-color: rgba(26, 26, 34, 0.8);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .investment-details {
            flex: 1;
        }

        .investment-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--color-text-primary);
            margin: 0 0 8px 0;
            display: flex;
            align-items: center;
        }

        .investment-summary {
            display: flex;
            align-items: center;
            font-size: 14px;
            color: var(--color-text-secondary);
        }

        /* 기본 금액 스타일 - FIL 기본값 */
        .investment-amount {
            font-weight: 600;
            color: var(--color-accent-teal);
            text-shadow: 0 0 5px rgba(101, 194, 198, 0.3);
        }
        
        /* ATH 금액 스타일 */
        .investment-amount.ath {
            color: var(--color-accent-yellow);
            text-shadow: 0 0 5px rgba(237, 233, 60, 0.3);
        }

        .toggle-icon {
            color: var(--color-text-primary);
            font-size: 18px;
            transition: transform 0.3s ease, color 0.3s ease;
        }

        .toggle-icon.open {
            transform: rotate(180deg);
            color: var(--color-accent-pink);
        }

        .investment-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
            padding: 0;
            margin-top: 0;
        }

        .investment-content.open {
            max-height: 500px; /* 충분히 큰 값으로 설정 */
            padding-top: 16px;
            margin-top: 8px;
            border-top: 1px solid rgba(225, 39, 136, 0.2);
        }

        .monthly-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .monthly-item {
            background-color: rgba(18, 18, 24, 0.7);
            border-radius: 10px;
            padding: 12px 14px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            transition: transform 0.2s, background-color 0.2s;
        }

        .monthly-item:hover {
            background-color: rgba(101, 194, 198, 0.1);
            transform: translateX(2px);
        }

        .month-label {
            font-size: 14px;
            color: var(--color-text-secondary);
        }

        /* 월별 금액 스타일 - FIL 기본값 */
        .month-value {
            font-weight: 600;
            color: var(--color-accent-teal);
            font-size: 14px;
        }
        
        /* ATH 월별 금액 스타일 */
        .month-value.ath {
            color: var(--color-accent-yellow); 
        }
        
        .month-value .coin-name {
            font-weight: 800; /* 더 굵은 Bold 처리 */
            margin-left: 4px;
            padding: 2px 8px; /* 패딩 추가 */
            border-radius: 6px; /* 모서리 둥글게 */
            font-size: 13px; /* 글씨 크기 살짝 작게 */
            letter-spacing: 0.5px; /* 자간 추가 */
        }
        
        /* FIL 코인명 스타일 */
        .month-value .coin-name.fil {
            color: var(--color-accent-teal);
            background-color: rgba(101, 194, 198, 0.1);
        }
        
        /* ATH 코인명 스타일 */
        .month-value .coin-name.ath {
            color: var(--color-accent-yellow);
            background-color: rgba(237, 233, 60, 0.1);
        }

        .status-badge {
            display: inline-flex; /* 상태 배지 표시 */
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 500;
            background-color: rgba(101, 194, 198, 0.15);
            color: var(--color-accent-teal);
            margin-left: 10px;
        }

        .error-message {
            background-color: rgba(225, 39, 136, 0.15);
            color: var(--color-accent-pink);
            padding: 16px;
            border-radius: 12px;
            margin-top: 16px;
            text-align: center;
            font-size: 14px;
            border: 1px solid rgba(225, 39, 136, 0.3);
        }
        
        /* 토큰 뱃지 - Liquidity만 표시 */
        .token-badge {
            display: none; /* 기본적으로 모든 토큰 뱃지 숨김 */
        }
        
        /* Liquidity 태그만 표시 */
        .token-badge.liquidity {
            display: inline-flex;
            align-items: center;
            padding: 3px 8px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 600;
            margin-left: 6px;
            background-color: rgba(237, 233, 60, 0.15);
            color: var(--color-accent-yellow);
            letter-spacing: 0.5px;
            border: 1px solid rgba(237, 233, 60, 0.3);
        }
        
        .loading-indicator {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
        }
        
        .loading-spinner {
            border: 3px solid rgba(101, 194, 198, 0.2);
            border-radius: 50%;
            border-top: 3px solid var(--color-accent-teal);
            width: 28px;
            height: 28px;
            animation: spin 1s linear infinite;
        }
        
        /* 배너 스타일 */
        .nanodc-banner {
            margin-top: 24px;
            padding: 8px;
            text-align: center;
            border-radius: 16px;
            overflow: hidden;
            background: linear-gradient(145deg, rgba(101, 194, 198, 0.05), rgba(225, 39, 136, 0.05));
            border: 1px solid rgba(101, 194, 198, 0.2);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .nanodc-banner:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.3);
        }
        
        .nanodc-banner img {
            max-width: 100%;
            border-radius: 12px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>

    <div class="container-fluid app-container" id="userApp_view" style="visibility:hidden;">
        <div class="dashboard-wrapper">
            <div class="investment-list" th:if="${not #lists.isEmpty(investmentList)}">
                <th:block th:each="investment, iter : ${investmentList}">
                    <div th:class="${'investment-card ' + (#strings.containsIgnoreCase(investment.token ?: '', 'fil') || investment.token == null ? 'coin-fil' : (#strings.containsIgnoreCase(investment.token ?: '', 'ath') || #strings.containsIgnoreCase(investment.token ?: '', 'ae') ? 'coin-ath' : 'coin-fil'))}" th:id="${'investment_item_' + iter.index}">
                        <div class="investment-header" th:onclick="'toggleContent(\'investment_content_' + ${iter.index} + '\')'">
                            <div class="investment-title-section">
                                <div class="investment-icon">
                                    <img th:if="${#strings.contains(#strings.toLowerCase(investment.token ?: ''), 'fil') || investment.token == null}" src="/assets/img/thumb/fil.png" alt="FIL" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">
                                    <img th:if="${#strings.contains(#strings.toLowerCase(investment.token ?: ''), 'ae') || #strings.contains(#strings.toLowerCase(investment.token ?: ''), 'ath')}" src="/assets/img/thumb/aethir.png" alt="ATH" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">
                                </div>
                                <div class="investment-details">
                                    <h3 class="investment-title">
                                        <span th:text="${#strings.replace(#strings.replace(#strings.replace(investment.hw_product_name, 'Liquidity', ''), 'Filecoin', 'FIL'), 'Aethir', 'ATH')}">제품명</span>
                                        <span class="status-badge" th:text="${investment.hw_status == 'active' ? '활성' : '비활성'}">활성</span>
                                        
                                        <!-- FIL이나 ATH 태그는 제거하고 Liquidity 태그만 표시 -->
                                        <span th:if="${#strings.contains(investment.hw_product_name, 'Liquidity') || #strings.contains(investment.token ?: '', 'Liquidity')}" class="token-badge liquidity">
                                            Liquidity
                                        </span>
                                    </h3>
                                    <div class="investment-summary">
                                        <span th:with="tokenName=${investment.token ?: 'FIL'}, 
                                              isAth=${#strings.containsIgnoreCase(tokenName, 'aethir') || #strings.containsIgnoreCase(tokenName, 'ath')}"
                                              th:class="${'investment-amount ' + (isAth ? 'ath' : '')}" 
                                              th:id="${'total_reward_' + investment.hw_product_id}">
                                            <span>계산 중...</span>
                                        </span>
                                        <span class="investment-type">&nbsp;&nbsp;Total Reward</span>
                                    </div>
                                </div>
                            </div>
                            <i class="fas fa-chevron-down toggle-icon" th:id="${'toggle_icon_' + iter.index}"></i>
                        </div>
                        <div class="investment-content" th:id="${'investment_content_' + iter.index}">
                            <!-- 해당 투자에 대한 보상 내역 -->
                            <div class="monthly-list" th:id="${'reward_list_' + investment.hw_product_id}">
                                <th:block th:each="reward : ${rewardDetailList}" th:if="${reward.hw_product_id == investment.hw_product_id}">
                                    <div class="monthly-item" th:attr="data-reward=${reward.reward_fil}">
                                        <span class="month-label" th:text="${#dates.format(reward.regdate, 'yyyy년 MM월')} + ' Reward'">2023년 01월 Reward</span>
                                        <span th:with="tokenName=${investment.token ?: 'FIL'}, 
                                              isAth=${#strings.containsIgnoreCase(tokenName, 'aethir') || #strings.containsIgnoreCase(tokenName, 'ath')}"
                                              th:class="${'month-value ' + (isAth ? 'ath' : '')}">
                                            <span th:text="${#numbers.formatDecimal(reward.reward_fil, 1, 2)}">0.00</span>
                                            <span th:with="isFil=${#strings.containsIgnoreCase(tokenName, 'filecoin') || #strings.containsIgnoreCase(tokenName, 'fil')},
                                                  isAth=${#strings.containsIgnoreCase(tokenName, 'aethir') || #strings.containsIgnoreCase(tokenName, 'ath')}"
                                                th:class="${'coin-name ' + (isFil ? 'fil' : (isAth ? 'ath' : 'fil'))}"
                                                th:text="${
                                                    isFil ? 'FIL' : 
                                                    isAth ? 'ATH' : 
                                                    #strings.replace(tokenName, 'Liquidity', '')
                                                }">FIL</span>
                                        </span>
                                    </div>
                                </th:block>
                                <!-- 보상 내역이 없을 경우 -->
                                <div class="monthly-item" th:if="${#lists.isEmpty(rewardDetailList) || !#lists.contains(rewardDetailList.![hw_product_id], investment.hw_product_id)}">
                                    <span class="month-label">보상 내역 없음</span>
                                    <span th:with="tokenName=${investment.token ?: 'FIL'}, 
                                          isAth=${#strings.containsIgnoreCase(tokenName, 'aethir') || #strings.containsIgnoreCase(tokenName, 'ath')}"
                                          th:class="${'month-value ' + (isAth ? 'ath' : '')}">
                                        <span>0.00</span>
                                        <span th:with="isFil=${#strings.containsIgnoreCase(tokenName, 'filecoin') || #strings.containsIgnoreCase(tokenName, 'fil')},
                                              isAth=${#strings.containsIgnoreCase(tokenName, 'aethir') || #strings.containsIgnoreCase(tokenName, 'ath')}"
                                          th:class="${'coin-name ' + (isFil ? 'fil' : (isAth ? 'ath' : 'fil'))}"
                                          th:text="${
                                              isFil ? 'FIL' : 
                                              isAth ? 'ATH' : 
                                              #strings.replace(tokenName, 'Liquidity', '')
                                          }">FIL</span>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                </th:block>
            </div>
            
            <!-- 투자 내역이 없을 경우 -->
            <div class="error-message" id="error-message" th:style="${#lists.isEmpty(investmentList) ? 'display: block;' : 'display: none;'}">
                투자 정보를 찾을 수 없습니다. 관리자에게 문의하세요.
            </div>
            
            <!-- NANODC 배너 추가 -->
            <div class="nanodc-banner">
                <img src="/assets/img/nanodc-banner.jpg" alt="NANODC 데이터센터 솔루션">
            </div>
            
            <!-- 오류 상태 히든 필드 -->
            <input type="hidden" th:value="${error}" id="main_error" class="hidden">
        </div>
    </div>

    <script>
        // 메인 콘텐츠 초기화
        document.addEventListener('DOMContentLoaded', function() {
            // 리스트 표시 애니메이션
            showDashboard();
            
            // 에러 확인
            checkForErrors();
            
            // 각 투자 항목의 총 리워드 계산
            calculateTotalRewards();
        });
        
        // 대시보드 표시 애니메이션
        function showDashboard() {
            const dashboard = document.getElementById('userApp_view');
            if (dashboard) {
                dashboard.style.visibility = 'visible';
                dashboard.style.opacity = '0';
                
                setTimeout(() => {
                    dashboard.style.transition = 'opacity 0.4s ease';
                    dashboard.style.opacity = '1';
                }, 100);
            }
        }
        
        // 투자 콘텐츠 토글
        function toggleContent(contentId) {
            const content = document.getElementById(contentId);
            const iconId = 'toggle_icon_' + contentId.split('_').pop();
            const icon = document.getElementById(iconId);
            
            // 콘텐츠 토글
            if (content.classList.contains('open')) {
                content.classList.remove('open');
                icon.classList.remove('open');
            } else {
                content.classList.add('open');
                icon.classList.add('open');
            }
        }
        
        // 에러 확인
        function checkForErrors() {
            const errorInput = document.getElementById('main_error');
            
            if (errorInput && errorInput.value) {
                const errorMessage = document.getElementById('error-message');
                const errorValue = errorInput.value;
                
                if (errorValue === 'No Investment' && errorMessage) {
                    errorMessage.style.display = 'block';
                } else if (errorValue === 'session closed') {
                    window.location.href = '/login';
                }
            }
        }
        
        // 각 투자의 총 리워드 계산 함수
        function calculateTotalRewards() {
            // 모든 투자 상품에 대해 처리
            const investmentCards = document.querySelectorAll('.investment-card');
            
            investmentCards.forEach(card => {
                // 상품 ID 추출
                const rewardListId = card.querySelector('.monthly-list').id;
                const productId = rewardListId.replace('reward_list_', '');
                
                // 해당 상품의 모든 월별 리워드 항목 가져오기
                const rewardItems = card.querySelectorAll('.monthly-item[data-reward]');
                
                // 총 리워드 계산
                let totalReward = 0;
                rewardItems.forEach(item => {
                    const rewardValue = parseFloat(item.getAttribute('data-reward')) || 0;
                    totalReward += rewardValue;
                });
                
                // 총 리워드 표시
                const totalRewardElement = document.getElementById('total_reward_' + productId);
                if (totalRewardElement) {
                    let tokenType = 'FIL';
                    const monthValue = card.querySelector('.monthly-item .month-value');
                    if (monthValue) {
                        const valueText = monthValue.textContent.trim();
                        const match = valueText.match(/[\d\.\s]+(.*)/);
                        if (match && match[1]) {
                            tokenType = match[1].trim();
                        }
                    }
                    
                    let displayTokenType = tokenType;
                    
                    if (/filecoin/i.test(displayTokenType)) {
                        displayTokenType = 'FIL';
                    }
                    else if (/aethir/i.test(displayTokenType)) {
                        displayTokenType = 'ATH';
                    }
                    else if (/fil/i.test(displayTokenType)) {
                        displayTokenType = 'FIL';
                    }
                    else if (/ath/i.test(displayTokenType)) {
                        displayTokenType = 'ATH';
                    }
                    
                    // JavaScript에서 코인 타입별 클래스 추가
                    const isAth = displayTokenType === 'ATH';
                    const coinClass = isAth ? 'ath' : 'fil';
                    totalRewardElement.className = `investment-amount ${isAth ? 'ath' : ''}`;
                    
                    // 소수점 2자리까지 표시, 코인명은 스타일 적용된 형태로
                    totalRewardElement.innerHTML = 
                        `<span>${totalReward.toFixed(2)}</span> <span class="coin-name ${coinClass}">${displayTokenType}</span>`;
                }
            });
        }
    </script>
</div>
    
</html>